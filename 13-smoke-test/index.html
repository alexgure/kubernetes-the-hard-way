<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Smoke Test - Kubernetes The Hard Way</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Smoke Test";
    var mkdocs_page_input_path = "13-smoke-test.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> Kubernetes The Hard Way</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../01-prerequisites/">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../01-prerequisites/">Prerequisites</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../02-client-tools/">Installing the Client Tools</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../03-compute-resources/">Provisioning Compute Resources</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../04-certificate-authority/">Provisioning the CA and Generating TLS Certificates</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../05-kubernetes-configuration-files/">Generating Kubernetes Configuration Files for Authentication</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../06-data-encryption-keys/">Generating the Data Encryption Config and Key</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../07-bootstrapping-etcd/">Bootstrapping the etcd Cluster</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../08-bootstrapping-kubernetes-controllers/">Bootstrapping the Kubernetes Control Plane</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../09-bootstrapping-kubernetes-workers/">Bootstrapping the Kubernetes Worker Nodes</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../10-configuring-kubectl/">Configuring kubectl for Remote Access</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../11-pod-network-routes/">Provisioning Pod Network Routes</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../12-dns-addon/">Deploying the DNS Cluster Add-on</a>
	    </li>
          
            <li class="toctree-l1 current">
		
    <a class="current" href="./">Smoke Test</a>
    <ul class="subnav">
            
    <li class="toctree-l2"><a href="#smoke-test">Smoke Test</a></li>
    
        <ul>
        
            <li><a class="toctree-l3" href="#data-encryption">Data Encryption</a></li>
        
            <li><a class="toctree-l3" href="#deployments">Deployments</a></li>
        
            <li><a class="toctree-l3" href="#services">Services</a></li>
        
        </ul>
    

    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../14-cleanup/">Cleaning Up</a>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">Kubernetes The Hard Way</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>Smoke Test</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="smoke-test">Smoke Test</h1>
<p>In this lab you will complete a series of tasks to ensure your Kubernetes cluster is functioning correctly.</p>
<h2 id="data-encryption">Data Encryption</h2>
<p>In this section you will verify the ability to <a href="https://kubernetes.io/docs/tasks/administer-cluster/encrypt-data/#verifying-that-data-is-encrypted">encrypt secret data at rest</a>.</p>
<p>Create a generic secret:</p>
<pre><code>kubectl create secret generic kubernetes-the-hard-way \
  --from-literal=&quot;mykey=mydata&quot;
</code></pre>

<p>Print a hexdump of the <code>kubernetes-the-hard-way</code> secret stored in etcd:</p>
<pre><code>gcloud compute ssh controller-0 \
  --command &quot;sudo ETCDCTL_API=3 etcdctl get \
  --endpoints=https://127.0.0.1:2379 \
  --cacert=/etc/etcd/ca.pem \
  --cert=/etc/etcd/kubernetes.pem \
  --key=/etc/etcd/kubernetes-key.pem\
  /registry/secrets/default/kubernetes-the-hard-way | hexdump -C&quot;
</code></pre>

<blockquote>
<p>output</p>
</blockquote>
<pre><code>00000000  2f 72 65 67 69 73 74 72  79 2f 73 65 63 72 65 74  |/registry/secret|
00000010  73 2f 64 65 66 61 75 6c  74 2f 6b 75 62 65 72 6e  |s/default/kubern|
00000020  65 74 65 73 2d 74 68 65  2d 68 61 72 64 2d 77 61  |etes-the-hard-wa|
00000030  79 0a 6b 38 73 3a 65 6e  63 3a 61 65 73 63 62 63  |y.k8s:enc:aescbc|
00000040  3a 76 31 3a 6b 65 79 31  3a 44 ac 6e ac 11 2f 28  |:v1:key1:D.n../(|
00000050  02 46 3d ad 9d cd 68 be  e4 cc 63 ae 13 e4 99 e8  |.F=...h...c.....|
00000060  6e 55 a0 fd 9d 33 7a b1  17 6b 20 19 23 dc 3e 67  |nU...3z..k .#.&gt;g|
00000070  c9 6c 47 fa 78 8b 4d 28  cd d1 71 25 e9 29 ec 88  |.lG.x.M(..q%.)..|
00000080  7f c9 76 b6 31 63 6e ea  ac c5 e4 2f 32 d7 a6 94  |..v.1cn..../2...|
00000090  3c 3d 97 29 40 5a ee e1  ef d6 b2 17 01 75 a4 a3  |&lt;=.)@Z.......u..|
000000a0  e2 c2 70 5b 77 1a 0b ec  71 c3 87 7a 1f 68 73 03  |..p[w...q..z.hs.|
000000b0  67 70 5e ba 5e 65 ff 6f  0c 40 5a f9 2a bd d6 0e  |gp^.^e.o.@Z.*...|
000000c0  44 8d 62 21 1a 30 4f 43  b8 03 69 52 c0 b7 2e 16  |D.b!.0OC..iR....|
000000d0  14 a5 91 21 29 fa 6e 03  47 e2 06 25 45 7c 4f 8f  |...!).n.G..%E|O.|
000000e0  6e bb 9d 3b e9 e5 2d 9e  3e 0a                    |n..;..-.&gt;.|
</code></pre>

<p>The etcd key should be prefixed with <code>k8s:enc:aescbc:v1:key1</code>, which indicates the <code>aescbc</code> provider was used to encrypt the data with the <code>key1</code> encryption key.</p>
<h2 id="deployments">Deployments</h2>
<p>In this section you will verify the ability to create and manage <a href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/">Deployments</a>.</p>
<p>Create a deployment for the <a href="https://nginx.org/en/">nginx</a> web server:</p>
<pre><code>kubectl create deployment nginx --image=nginx
</code></pre>

<p>List the pod created by the <code>nginx</code> deployment:</p>
<pre><code>kubectl get pods -l app=nginx
</code></pre>

<blockquote>
<p>output</p>
</blockquote>
<pre><code>NAME                     READY   STATUS    RESTARTS   AGE
nginx-554b9c67f9-vt5rn   1/1     Running   0          10s
</code></pre>

<h3 id="port-forwarding">Port Forwarding</h3>
<p>In this section you will verify the ability to access applications remotely using <a href="https://kubernetes.io/docs/tasks/access-application-cluster/port-forward-access-application-cluster/">port forwarding</a>.</p>
<p>Retrieve the full name of the <code>nginx</code> pod:</p>
<pre><code>POD_NAME=$(kubectl get pods -l app=nginx -o jsonpath=&quot;{.items[0].metadata.name}&quot;)
</code></pre>

<p>Forward port <code>8080</code> on your local machine to port <code>80</code> of the <code>nginx</code> pod:</p>
<pre><code>kubectl port-forward $POD_NAME 8080:80
</code></pre>

<blockquote>
<p>output</p>
</blockquote>
<pre><code>Forwarding from 127.0.0.1:8080 -&gt; 80
Forwarding from [::1]:8080 -&gt; 80
</code></pre>

<p>In a new terminal make an HTTP request using the forwarding address:</p>
<pre><code>curl --head http://127.0.0.1:8080
</code></pre>

<blockquote>
<p>output</p>
</blockquote>
<pre><code>HTTP/1.1 200 OK
Server: nginx/1.17.3
Date: Sat, 14 Sep 2019 21:10:11 GMT
Content-Type: text/html
Content-Length: 612
Last-Modified: Tue, 13 Aug 2019 08:50:00 GMT
Connection: keep-alive
ETag: &quot;5d5279b8-264&quot;
Accept-Ranges: bytes
</code></pre>

<p>Switch back to the previous terminal and stop the port forwarding to the <code>nginx</code> pod:</p>
<pre><code>Forwarding from 127.0.0.1:8080 -&gt; 80
Forwarding from [::1]:8080 -&gt; 80
Handling connection for 8080
^C
</code></pre>

<h3 id="logs">Logs</h3>
<p>In this section you will verify the ability to <a href="https://kubernetes.io/docs/concepts/cluster-administration/logging/">retrieve container logs</a>.</p>
<p>Print the <code>nginx</code> pod logs:</p>
<pre><code>kubectl logs $POD_NAME
</code></pre>

<blockquote>
<p>output</p>
</blockquote>
<pre><code>127.0.0.1 - - [14/Sep/2019:21:10:11 +0000] &quot;HEAD / HTTP/1.1&quot; 200 0 &quot;-&quot; &quot;curl/7.52.1&quot; &quot;-&quot;
</code></pre>

<h3 id="exec">Exec</h3>
<p>In this section you will verify the ability to <a href="https://kubernetes.io/docs/tasks/debug-application-cluster/get-shell-running-container/#running-individual-commands-in-a-container">execute commands in a container</a>.</p>
<p>Print the nginx version by executing the <code>nginx -v</code> command in the <code>nginx</code> container:</p>
<pre><code>kubectl exec -ti $POD_NAME -- nginx -v
</code></pre>

<blockquote>
<p>output</p>
</blockquote>
<pre><code>nginx version: nginx/1.17.3
</code></pre>

<h2 id="services">Services</h2>
<p>In this section you will verify the ability to expose applications using a <a href="https://kubernetes.io/docs/concepts/services-networking/service/">Service</a>.</p>
<p>Expose the <code>nginx</code> deployment using a <a href="https://kubernetes.io/docs/concepts/services-networking/service/#type-nodeport">NodePort</a> service:</p>
<pre><code>kubectl expose deployment nginx --port 80 --type NodePort
</code></pre>

<blockquote>
<p>The LoadBalancer service type can not be used because your cluster is not configured with <a href="https://kubernetes.io/docs/getting-started-guides/scratch/#cloud-provider">cloud provider integration</a>. Setting up cloud provider integration is out of scope for this tutorial.</p>
</blockquote>
<p>Retrieve the node port assigned to the <code>nginx</code> service:</p>
<pre><code>NODE_PORT=$(kubectl get svc nginx \
  --output=jsonpath='{range .spec.ports[0]}{.nodePort}')
</code></pre>

<p>Create a firewall rule that allows remote access to the <code>nginx</code> node port:</p>
<pre><code>gcloud compute firewall-rules create kubernetes-the-hard-way-allow-nginx-service \
  --allow=tcp:${NODE_PORT} \
  --network kubernetes-the-hard-way
</code></pre>

<p>Retrieve the external IP address of a worker instance:</p>
<pre><code>EXTERNAL_IP=$(gcloud compute instances describe worker-0 \
  --format 'value(networkInterfaces[0].accessConfigs[0].natIP)')
</code></pre>

<p>Make an HTTP request using the external IP address and the <code>nginx</code> node port:</p>
<pre><code>curl -I http://${EXTERNAL_IP}:${NODE_PORT}
</code></pre>

<blockquote>
<p>output</p>
</blockquote>
<pre><code>HTTP/1.1 200 OK
Server: nginx/1.17.3
Date: Sat, 14 Sep 2019 21:12:35 GMT
Content-Type: text/html
Content-Length: 612
Last-Modified: Tue, 13 Aug 2019 08:50:00 GMT
Connection: keep-alive
ETag: &quot;5d5279b8-264&quot;
Accept-Ranges: bytes
</code></pre>

<p>Next: <a href="../14-cleanup/">Cleaning Up</a></p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../14-cleanup/" class="btn btn-neutral float-right" title="Cleaning Up">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../12-dns-addon/" class="btn btn-neutral" title="Deploying the DNS Cluster Add-on"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../12-dns-addon/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../14-cleanup/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>

</body>
</html>
